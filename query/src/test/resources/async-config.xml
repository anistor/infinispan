<?xml version="1.0" encoding="UTF-8"?>
<infinispan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="urn:infinispan:config:6.0 http://www.infinispan.org/schemas/infinispan-config-6.0.xsd
                                urn:infinispan:config:jdbc:6.0 http://docs.jboss.org/infinispan/schemas/infinispan-cachestore-jdbc-config-6.0.xsd"
            xmlns="urn:infinispan:config:6.0"
            xmlns:jdbc="urn:infinispan:config:jdbc:6.0">

   <global>
      <transport clusterName="default" distributedSyncTimeout="600000">
         <properties>
            <property name="configurationFile" value="jgroups-udp.xml"/>
         </properties>
      </transport>
   </global>

   <default/>

   <namedCache name="JDBCBased_LocalIndex">
      <transaction transactionMode="TRANSACTIONAL" lockingMode="OPTIMISTIC"/>

      <clustering mode="REPL">
         <sync replTimeout="20000" />
      </clustering>

      <indexing enabled="true" indexLocalOnly="true">
         <properties >
             <property name="default.directory_provider" value="infinispan" />
             <property name="default.indexmanager" value="org.infinispan.query.indexmanager.InfinispanIndexManager" />
             <property name="lucene_version" value="LUCENE_36" />

            <property name="default.locking_cachename" value="LuceneIndexesLocking_custom" />
            <property name="default.data_cachename" value="LuceneIndexesData_custom" />
            <property name="default.metadata_cachename" value="LuceneIndexesMetadata_custom" />
         </properties>
      </indexing>
   </namedCache>


   <!-- ***************************** -->
   <!--  Cache to store Lucene Metadata  -->
   <!-- ***************************** -->
   <namedCache name="LuceneIndexesMetadata_custom">
      <transaction transactionMode="TRANSACTIONAL" lockingMode="OPTIMISTIC"/>

      <clustering
            mode="REPL">
         <stateTransfer fetchInMemoryState="true" />
         <sync replTimeout="25000" />
      </clustering>
      <indexing enabled="false" />

      <persistence>
         <stringKeyedJdbcStore xmlns="urn:infinispan:config:jdbc:6.0" key2StringMapper="org.infinispan.lucene.LuceneKey2StringMapper" fetchPersistentState="false" ignoreModifications="false" purgeOnStartup="true">
            <connectionPool connectionUrl="jdbc:h2:mem:infinispan_string_based;DB_CLOSE_DELAY=-1" username="sa" driverClass="org.h2.Driver"/>
            <stringKeyedTable dropOnExit="true" createOnStart="true" prefix="ISPN_STRING_TABLE">
               <idColumn name="ID_COLUMN" type="VARCHAR(255)" />
               <dataColumn name="DATA_COLUMN" type="BINARY" />
               <timestampColumn name="TIMESTAMP_COLUMN" type="BIGINT" />
            </stringKeyedTable>
            <async enabled="true" flushLockTimeout="5000" modificationQueueSize="1024" shutdownTimeout="25000" threadPoolSize="2"/>
         </stringKeyedJdbcStore>
      </persistence>
   </namedCache>

   <!-- **************************** -->
   <!--  Cache to store Lucene data  -->
   <!-- **************************** -->
   <namedCache name="LuceneIndexesData_custom">
      <transaction transactionMode="TRANSACTIONAL" lockingMode="OPTIMISTIC"/>

      <clustering mode="REPL">
         <stateTransfer fetchInMemoryState="true" />
         <sync replTimeout="25000" />
      </clustering>
      <indexing enabled="false" />

      <persistence>
         <stringKeyedJdbcStore xmlns="urn:infinispan:config:jdbc:6.0" key2StringMapper="org.infinispan.lucene.LuceneKey2StringMapper" fetchPersistentState="false" ignoreModifications="false" purgeOnStartup="true">
            <connectionPool connectionUrl="jdbc:h2:mem:infinispan_string_based;DB_CLOSE_DELAY=-1" username="sa" driverClass="org.h2.Driver"/>
            <stringKeyedTable dropOnExit="true" createOnStart="true" prefix="ISPN_STRING_TABLE">
               <idColumn name="ID_COLUMN" type="VARCHAR(255)" />
               <dataColumn name="DATA_COLUMN" type="BINARY" />
               <timestampColumn name="TIMESTAMP_COLUMN" type="BIGINT" />
            </stringKeyedTable>
            <async enabled="true" flushLockTimeout="5000" modificationQueueSize="1024" shutdownTimeout="25000" threadPoolSize="2"/>
         </stringKeyedJdbcStore>
      </persistence>
   </namedCache>

   <!-- ***************************** -->
   <!--  Cache to store Lucene locks  -->
   <!-- ***************************** -->
   <namedCache name="LuceneIndexesLocking_custom">
      <transaction transactionMode="TRANSACTIONAL" lockingMode="OPTIMISTIC"/>

      <clustering mode="REPL">
         <stateTransfer fetchInMemoryState="true" />
         <sync replTimeout="25000" />
      </clustering>
      <indexing enabled="false" />

      <persistence>
         <stringKeyedJdbcStore xmlns="urn:infinispan:config:jdbc:6.0" key2StringMapper="org.infinispan.lucene.LuceneKey2StringMapper" fetchPersistentState="false" ignoreModifications="false" purgeOnStartup="true">
            <connectionPool connectionUrl="jdbc:h2:mem:infinispan_string_based;DB_CLOSE_DELAY=-1" username="sa" driverClass="org.h2.Driver"/>
            <stringKeyedTable dropOnExit="true" createOnStart="true" prefix="ISPN_STRING_TABLE">
               <idColumn name="ID_COLUMN" type="VARCHAR(255)" />
               <dataColumn name="DATA_COLUMN" type="BINARY" />
               <timestampColumn name="TIMESTAMP_COLUMN" type="BIGINT" />
            </stringKeyedTable>
            <async enabled="true" flushLockTimeout="5000" modificationQueueSize="1024" shutdownTimeout="25000" threadPoolSize="2"/>
         </stringKeyedJdbcStore>
      </persistence>
   </namedCache>

</infinispan>

